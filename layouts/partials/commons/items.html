{{- $pages := . -}}
{{- $atf := false -}}
{{- $scrollsnap := false -}}
{{- $groupbyyear := false -}}
{{- $currentyear := false -}}
{{ if reflect.IsMap . }}
  {{- $pages = .pages -}}
  {{- $atf = .abovethefold -}}
  {{- $groupbyyear = .groupbyyear -}}
  {{ with .scrollsnap }}
    {{- $scrollsnap = true -}}
  {{ end }}
{{ end }}
{{ with $pages }}
  {{ if gt . 0 }}
    {{- $section := (index . 0).Type -}}
    {{ if eq (index . 0).Kind "section" }}
      {{- $section = "pages" -}}
    {{ end }}
    <div class="{{ $section }}">
      {{ range $index, $items := . }}
        {{ if $groupbyyear }}
          {{ $year := .Date.Format "2006" }}
          {{ if ne $year $currentyear }}
            <h2 class="year">{{ $year }}</h2>
            {{ $currentyear = $year }}
          {{ end }}
        {{ end }}
        <div>
          {{ if and ($atf) (lt $index 2) }}
            {{ .Scratch.Set "notLazy" true }}
          {{ end }}
          {{ if $scrollsnap }}
            {{ .Scratch.Set "scrollsnap" true }}
          {{ end }}
          {{ partial (print $section "/item.html") . }}
          {{ if $scrollsnap }}
            {{ .Scratch.Delete "scrollsnap" }}
          {{ end }}
        </div>
      {{ end }}
    </div>
  {{ end }}
{{ end }}
